# Widget Extension æ–‡æª”

æœ¬é …ç›®åŒ…å«å…©å€‹ Widget Extensionsï¼Œæä¾›æ¡Œé¢å°å·¥å…·èˆ‡å³æ™‚å‹•æ…‹ (Live Activity) åŠŸèƒ½ï¼Œè®“ç”¨æˆ¶ç„¡éœ€æ‰“é–‹ App å³å¯æŸ¥çœ‹ä»»å‹™èˆ‡å°ˆæ³¨ç‹€æ…‹ã€‚

## ğŸ“± DailyTaskWidget (æ¡Œé¢å°å·¥å…·)

`DailyTaskWidget` æ˜¯ä¸€å€‹é¡¯ç¤ºä»Šæ—¥ä»»å‹™æ¦‚è¦½çš„æ¡Œé¢å°å·¥å…·ï¼Œæ”¯æŒ Small å’Œ Medium å…©ç¨®å°ºå¯¸ã€‚

### æ ¸å¿ƒçµ„ä»¶

#### 1. DailyTaskWidgetProvider

è² è²¬ç®¡ç† Widget çš„æ™‚é–“ç·š (Timeline) æ›´æ–°ã€‚

- **Placeholder**: æä¾›é è¦½ç”¨çš„å‡æ•¸æ“šã€‚
- **Snapshot**: æä¾› Widget åº«é è¦½çš„å¿«ç…§ã€‚
- **Timeline**:
  - è®€å–å…±äº«çš„ `UserDefaults` (App Group: `group.task-creator.com.task-creator`)ã€‚
  - ç²å–ä»Šæ—¥ä»»å‹™æ•¸æ“šã€‚
  - è¨­å®šæ¯ 15 åˆ†é˜åˆ·æ–°ä¸€æ¬¡ã€‚

#### 2. DailyTaskWidgetEntryView

Widget çš„ä¸»è¦è¦–åœ–å±¤ã€‚

- **èƒŒæ™¯**: çµ±ä¸€ä½¿ç”¨æš–è‰²èª¿èƒŒæ™¯ (`#FFF3D9`)ï¼Œç‡Ÿé€ æº«é¦¨æ„Ÿã€‚
- **å…§å®¹**:
  - **æ¨™é¡Œå€**: é¡¯ç¤º "æº–å‚™å¥½..." èˆ‡æ´¾å°åœ–æ¨™ã€‚
  - **ç‹€æ…‹å€**: é¡¯ç¤ºå‰©é¤˜ä»»å‹™æ•¸é‡æˆ–é€¾æœŸæé†’ã€‚
  - **æ“ä½œå€**: "é–‹å§‹å°ˆæ³¨" æŒ‰éˆ•ï¼Œé»æ“Šè·³è½‰è‡³ App çš„ç•ªèŒ„é˜é é¢ (`taskflow://pomodoro/start`)ã€‚
    - æŒ‰éˆ•èƒŒæ™¯è‰²: äº®æ©™è‰² (`#FF7A1A`)ã€‚

### æ•¸æ“šå…±äº«

Widget èˆ‡ä¸» App é€šé **App Groups** å…±äº«æ•¸æ“šã€‚

- **Key**: `tasks`
- **æ ¼å¼**: JSON ç·¨ç¢¼çš„ `[Task]` æ•¸çµ„ã€‚

---

## â±ï¸ TimerWidget (è¨ˆæ™‚å™¨ Live Activity)

`TimerWidgetLiveActivity` æä¾›ç¾ä»£åŒ–çš„è¨ˆæ™‚å™¨å³æ™‚å‹•æ…‹é¡¯ç¤ºï¼Œæ”¯æŒé–å®šè¢å¹•å’Œéˆå‹•å³¶ (Dynamic Island)ã€‚

### ğŸ“Š æ•¸æ“šæ¨¡å‹

#### TimerWidgetAttributes

å®šç¾© Live Activity çš„éœæ…‹å’Œå‹•æ…‹æ•¸æ“šã€‚

**ä½ç½®**: `task-creator/Models/TimerWidgetAttributes.swift`

```swift
@available(iOS 16.1, *)
public struct TimerWidgetAttributes: ActivityAttributes {
    // éœæ…‹æ•¸æ“šï¼ˆå‰µå»ºæ™‚è¨­å®šï¼‰
    public var timerMode: String        // "ç•ªèŒ„é˜", "å€’è¨ˆæ™‚", "æ­£è¨ˆæ™‚"
    public var categoryName: String     // ä»»å‹™é¡åˆ¥åç¨±
    public var targetEndTime: Date      // ç›®æ¨™çµæŸæ™‚é–“

    // å‹•æ…‹æ•¸æ“šï¼ˆå¯æ›´æ–°ï¼‰
    public struct ContentState: Codable, Hashable {
        public var isPaused: Bool
        public var elapsedSeconds: Int   // å·²ç¶“éç§’æ•¸
        public var totalSeconds: Int     // ç¸½ç§’æ•¸

        // è¨ˆç®—å±¬æ€§
        public var progress: Double      // 0.0 ~ 1.0
        public var remainingSeconds: Int // å‰©é¤˜æ™‚é–“
    }
}
```

### ğŸ¨ UI è¨­è¨ˆ

#### 1. é–å®šè¢å¹• (Lock Screen)

**å¸ƒå±€ç‰¹è‰²**:

- **å·¦å´**: åœ“å½¢é€²åº¦ç’°
  - æ¼¸å±¤è‰²å½©ï¼ˆç¶ è‰²ç³»é‹è¡Œä¸­/æ©™è‰²ç³»å·²æš«åœï¼‰
  - ä¸­å¿ƒé¡¯ç¤ºæ¨¡å¼åœ–æ¨™å’Œé€²åº¦ç™¾åˆ†æ¯”
  - å°ºå¯¸: 80x80ptï¼Œç·šå¯¬ 8pt
- **å³å´**: ä¿¡æ¯é¢æ¿
  - è¨ˆæ™‚å™¨æ¨¡å¼æ¨™é¡Œ
  - ä»»å‹™é¡åˆ¥åç¨±
  - å¤§å­—è™Ÿå€’æ•¸è¨ˆæ™‚å™¨ï¼ˆSF Pro Roundedï¼‰
  - å·²ç”¨æ™‚é–“ â° / å‰©é¤˜æ™‚é–“ â³

**è¦–è¦ºæ•ˆæœ**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”   ç•ªèŒ„é˜                   â”‚
â”‚  â”‚  ğŸ…  â”‚   æ•¸å­¸ä½œæ¥­                 â”‚
â”‚  â”‚ 80%  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜   25:00                    â”‚
â”‚             (Gradient)                â”‚
â”‚             â° 05:00  â³ 20:00       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. éˆå‹•å³¶ - Expanded (å±•é–‹ç‹€æ…‹)

**å€åŸŸåŠƒåˆ†**:

- **Leading (å·¦å´)**: æ¨¡å¼åœ–æ¨™ + ä»»å‹™åç¨±
- **Center (ä¸­å¤®)**:
  - å¤§å­—è™Ÿè¨ˆæ™‚å™¨ï¼ˆ32pt, æ¼¸å±¤é¡è‰²ï¼‰
  - ç·šæ€§é€²åº¦æ¢ï¼ˆ8pt é«˜ï¼Œåœ“è§’ 4ptï¼‰
  - é€²åº¦ç™¾åˆ†æ¯”
- **Trailing (å³å´)**: å·²ç”¨/å‰©é¤˜æ™‚é–“æ¨™ç±¤
- **Bottom (åº•éƒ¨)**: äº’å‹•æŒ‰éˆ•
  - â¸/â–¶ æš«åœ/ç¹¼çºŒæŒ‰éˆ•ï¼ˆå‹•æ…‹åˆ‡æ›ï¼‰
  - â¹ åœæ­¢æŒ‰éˆ•ï¼ˆç´…è‰²æç¤ºï¼‰

**è¦–è¦ºæ•ˆæœ**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ… ç•ªèŒ„é˜                   â° 05:00     â”‚
â”‚    æ•¸å­¸ä½œæ¥­                 â³ 20:00     â”‚
â”‚                                          â”‚
â”‚           25:00                          â”‚
â”‚      (Large Gradient)                    â”‚
â”‚                                          â”‚
â”‚    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  80%               â”‚
â”‚                                          â”‚
â”‚ [â¸ æš«åœ]            [â¹ åœæ­¢]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. éˆå‹•å³¶ - Compact (ç·Šæ¹Šç‹€æ…‹)

**å·¦å´**: æ¨¡å¼åœ–æ¨™ï¼ˆğŸ…/â±/â°ï¼‰  
**å³å´**: åœ“å½¢é€²åº¦ç’° + å€’æ•¸è¨ˆæ™‚å™¨

- é€²åº¦ç’°å‹•ç•«é¡¯ç¤ºé€²åº¦
- æ™‚é–“æ–‡å­—å±…ä¸­ï¼ˆ10ptï¼‰
- å°ºå¯¸: 32x32pt

```
ğŸ…  [ â—‹â”€â”€â”€â”€â”€â”€â”€â— ]  25:00
```

#### 4. éˆå‹•å³¶ - Minimal (è¿·ä½ ç‹€æ…‹)

æ¨¡å¼åœ–æ¨™ç–ŠåŠ åœ“å½¢é€²åº¦æŒ‡ç¤ºå™¨ã€‚

```
[ â—‹ ğŸ… â— ]
```

### ğŸ¨ è‰²å½©ç³»çµ±

| ç‹€æ…‹   | ä¸»è‰²             | æ¼¸å±¤            | ç”¨é€”           |
| ------ | ---------------- | --------------- | -------------- |
| é‹è¡Œä¸­ | Green (#4CAF50)  | Green â†’ Mint    | é€²åº¦ç’°ã€é€²åº¦æ¢ |
| å·²æš«åœ | Orange (#FF9800) | Orange â†’ Yellow | é€²åº¦ç’°ã€é€²åº¦æ¢ |
| æŒ‰éˆ•   | -                | åŠé€æ˜è‰²å¡Š      | èƒŒæ™¯æç¤º       |

### ğŸ”„ ç‹€æ…‹ç®¡ç†

#### Live Activity ç”Ÿå‘½é€±æœŸ

1. **å•Ÿå‹•** (`startLiveActivity`)
   - åœ¨è¨ˆæ™‚å™¨é–‹å§‹æ™‚èª¿ç”¨
   - å‰µå»º `TimerWidgetAttributes` å’Œåˆå§‹ `ContentState`
   - ä½¿ç”¨ `Activity.request()` å•Ÿå‹•

2. **æ›´æ–°** (`updateLiveActivity`)
   - åœ¨æš«åœ/ç¹¼çºŒæ™‚èª¿ç”¨
   - æ›´æ–° `isPaused` ç‹€æ…‹
   - ä½¿ç”¨ `activity.update()` æ¨é€æ–°ç‹€æ…‹

3. **çµæŸ** (`endLiveActivity`)
   - è¨ˆæ™‚å™¨çµæŸæˆ–åœæ­¢æ™‚èª¿ç”¨
   - ä½¿ç”¨ `activity.end()` é—œé–‰
   - è¨­å®š `dismissalPolicy` ç‚º `.default`

#### æ•¸æ“šåŒæ­¥

Live Activity ä½¿ç”¨ç³»çµ±è‡ªå‹•å€’æ•¸ï¼š

- `targetEndTime` ç”±ç³»çµ±è‡ªå‹•è¨ˆç®—å‰©é¤˜æ™‚é–“
- ç„¡éœ€æ‰‹å‹•æ›´æ–°å€’æ•¸è¨ˆæ™‚å™¨
- åƒ…åœ¨ç‹€æ…‹è®ŠåŒ–ï¼ˆæš«åœ/ç¹¼çºŒï¼‰æ™‚æ¨é€æ›´æ–°

### ğŸ”˜ äº’å‹•åŠŸèƒ½

#### App Intents (ä½”ä½ç¬¦)

```swift
struct ToggleTimerIntent: AppIntent {
    static var title: LocalizedStringResource = "Toggle Timer"
    func perform() async throws -> some IntentResult
}

struct StopTimerIntent: AppIntent {
    static var title: LocalizedStringResource = "Stop Timer"
    func perform() async throws -> some IntentResult
}
```

> **æ³¨æ„**: ç•¶å‰æŒ‰éˆ•ç‚ºä½”ä½ç¬¦å¯¦ç¾ã€‚å®Œæ•´åŠŸèƒ½éœ€è¦ï¼š
>
> - é€šé App Groups èˆ‡ä¸»æ‡‰ç”¨é€šè¨Š
> - å¯¦ç¾ç‹€æ…‹åŒæ­¥æ©Ÿåˆ¶
> - è™•ç†æŒ‰éˆ•é»æ“Šäº‹ä»¶

---

## ğŸ› ï¸ æœ€è¿‘æ›´æ–°

### Timer Live Activity UI å¢å¼· (2026-01-31)

- âœ… **åœ“å½¢é€²åº¦ç’°**: æ¼¸å±¤è‰²å½©ï¼Œæµæš¢å‹•ç•«
- âœ… **ç·šæ€§é€²åº¦æ¢**: ç¾ä»£è¨­è¨ˆï¼Œæ¸…æ™°åé¥‹
- âœ… **äº’å‹•æŒ‰éˆ•**: æš«åœ/ç¹¼çºŒã€åœæ­¢åŠŸèƒ½
- âœ… **è±å¯Œä¿¡æ¯**: å·²ç”¨/å‰©é¤˜æ™‚é–“ã€é€²åº¦ç™¾åˆ†æ¯”
- âœ… **æ•¸æ“šæ¨¡å‹å¢å¼·**: æ–°å¢ `elapsedSeconds`ã€`totalSeconds`
- âœ… **æ¼¸å±¤è¦–è¦º**: SF Pro Rounded å­—é«”ï¼Œç¾ä»£é…è‰²

### DailyTaskWidget UI å„ªåŒ– (2025-12-02)

- **èƒŒæ™¯çµ±ä¸€**: ç§»é™¤åŸæœ‰çš„æ¼¸å±¤èƒŒæ™¯ï¼Œæ”¹ç‚ºçµ±ä¸€çš„æš–è‰²èƒŒæ™¯ (`#FFF3D9`)
- **æŒ‰éˆ•æ¨£å¼**: "é–‹å§‹å°ˆæ³¨" æŒ‰éˆ•æ”¹ç‚ºç´”è‰²èƒŒæ™¯ (`#FF7A1A`)

---

## ğŸ“¦ æ¡†æ¶ä¾è³´

### TimerWidget

```swift
import ActivityKit    // Live Activity æ”¯æŒ
import WidgetKit      // Widget é…ç½®
import SwiftUI        // UI çµ„ä»¶
import AppIntents     // äº’å‹•æŒ‰éˆ•
```

### DailyTaskWidget

```swift
import WidgetKit
import SwiftUI
```

---

## âš™ï¸ é…ç½®è¦æ±‚

### Target Membership

- `TimerWidgetAttributes.swift`:
  - âœ… task-creator (ä¸»æ‡‰ç”¨)
  - âœ… TimerWidgetExtension

### App Groups

- **Group ID**: `group.task-creator.com.task-creator`
- **ç”¨é€”**: ä¸»æ‡‰ç”¨èˆ‡ Widget é–“æ•¸æ“šå…±äº«

### æœ€ä½ç³»çµ±è¦æ±‚

- **Live Activity**: iOS 16.1+
- **Dynamic Island**: iPhone 14 Pro+ï¼ˆå…¶ä»–æ©Ÿå‹åƒ…é¡¯ç¤ºé–å®šè¢å¹•ï¼‰
- **Widget**: iOS 14.0+

---

## âš ï¸ æ³¨æ„äº‹é …

1. **Widget åˆ·æ–°é™åˆ¶**: å— iOS ç³»çµ±é™åˆ¶ï¼Œä¸¦éå¯¦æ™‚æ›´æ–°
2. **Live Activity é™åˆ¶**:
   - æ¯å€‹æ‡‰ç”¨æœ€å¤š 8 å€‹åŒæ™‚æ´»èºçš„ Live Activity
   - ç³»çµ±å¯èƒ½åœ¨ä½é›»é‡æˆ–è¨˜æ†¶é«”ä¸è¶³æ™‚çµ‚æ­¢ Live Activity
3. **Preview é™åˆ¶**: Live Activity Preview åœ¨æ¨¡æ“¬å™¨ä¸­æ”¯æŒæœ‰é™ï¼Œå»ºè­°çœŸæ©Ÿæ¸¬è©¦
4. **Bundle ID**: ç¢ºä¿ Widget Extension Bundle ID ä»¥ä¸»æ‡‰ç”¨ Bundle ID ç‚ºå‰ç¶´

---

## ğŸš€ æ¸¬è©¦å»ºè­°

### æ¨¡æ“¬å™¨æ¸¬è©¦

- âœ… UI å¸ƒå±€æª¢æŸ¥
- âœ… ç·¨è­¯é©—è­‰
- âš ï¸ Live Activity åŠŸèƒ½å—é™

### çœŸæ©Ÿæ¸¬è©¦ï¼ˆæ¨è–¦ï¼‰

- âœ… å®Œæ•´ Live Activity åŠŸèƒ½
- âœ… Dynamic Island æ¸¬è©¦ï¼ˆiPhone 14 Pro+ï¼‰
- âœ… é–å®šè¢å¹•é¡¯ç¤º
- âœ… äº’å‹•æŒ‰éˆ•ï¼ˆå¾…å¯¦ç¾ï¼‰
- âœ… ç³»çµ±å€’æ•¸è¨ˆæ™‚é©—è­‰
